#!/bin/bash

set -e

REPO_ROOT="${BASH_SOURCE%/*}"
BIN_DIR="$REPO_ROOT/bin"
NODE_EXE="$BIN_DIR/node"
YARN_EXE="$BIN_DIR/yarn"
MAIN_EXE="$REPO_ROOT/lib/main.js"

source "$BIN_DIR/common"

log_info "Installing TypeScript"

"$YARN_EXE" --frozen-lockfile --no-default-rc --no-progress --silent

log_info "Building"

# TODO: make bin/tsc
"$YARN_EXE" run --silent tsc

log_info "Running main"

"$NODE_EXE" "$MAIN_EXE" "$@"
